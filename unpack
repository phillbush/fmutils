#!/bin/sh
# unpack - unarchive archive files
# this file in public domain

die()
{
	printf "%s\n" "$*" >&2
	exit 1
}

crun()
{
	command -v "$1" 2>&1 >/dev/null ||
		die "unpack: utility $1 is not installed"

	"$@" || die "failed to extract"
}

case "$#" in
	(1) set -- "$1" "$PWD" ;;
	(2) ;;
	(*) die "usage: unpack file [destdir]" ;;
esac

! [ -e "$1" ] && die "unpack: $1: not a valid file"
! [ -d "$2" ] && die "unpack: $2: not a valid directory"

case "${1##*.}" in
tgz|gz)  crun tar xzf "$1" -C "$2" ;;
txz|xz)  crun tar xJf "$1" -C "$2" ;;
tbz|bz2) crun tar xjf "$1" -C "$2" ;;
tar)     crun tar xf  "$1" -C "$2" ;;
zip)     crun unzip -d "$2" "$1"   ;;
rar)     crun unrar x "$1" "$2"    ;;
7z)      crun 7z x -o "$2" "$1"    ;;
*) die "unpack: $1: not a supported archive file\n" ;;
esac

printf "extracted %s to %s\n" "$1" "$2"
